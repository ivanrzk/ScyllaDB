{"version":3,"sources":["../src/datasource.js"],"names":["dsRegularEscape","value","replace","dsSpecialRegexEscape","_","GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","type","url","name","q","withCredentials","severityLevels","jsonData","severity_critical","undefined","toLowerCase","severity_high","severity_warning","severity_info","queryActive","querySilenced","queryInhibited","expr","active","silenced","inhibited","length","map","x","join","query","matchedFunction","queryTypes","regex","i","matches","match","encodeURIComponent","interpolateQueryExpr","unique","Set","results","defaultTargetData","datasourceRequest","createUrl","method","headers","then","response","data","forEach","Object","keys","castArray","v","JSON","stringify","has","add","push","text","options","buildQueryParameters","targets","filter","t","hide","when","labelSelector","parseLabelSelector","columnsDict","getColumnsDict","columns","getColumns","row","Array","fill","item","Date","parse","label","annotation","rows","now","variable","defaultFormatFn","escapedValues","column","input","trim","split","index","severityDefined","labelIndex","selectedLabel","status","message","title","target","legendFormat","props","exprArray","labels","aliasRegex","g1"],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\n\nexport class GenericDatasource {\n\n    constructor(instanceSettings, $q, backendSrv, templateSrv) {\n        this.type = instanceSettings.type;\n        this.url = instanceSettings.url;\n        this.name = instanceSettings.name;\n        this.q = $q;\n        this.backendSrv = backendSrv;\n        this.templateSrv = templateSrv;\n        this.withCredentials = instanceSettings.withCredentials;\n\n        this.severityLevels = {};\n        if (instanceSettings.jsonData.severity_critical != undefined) {\n            this.severityLevels[instanceSettings.jsonData.severity_critical.toLowerCase()] = 4;\n        }\n        if (instanceSettings.jsonData.severity_high != undefined) {\n            this.severityLevels[instanceSettings.jsonData.severity_high.toLowerCase()] = 3;\n        }\n        if (instanceSettings.jsonData.severity_warning != undefined) {\n            this.severityLevels[instanceSettings.jsonData.severity_warning.toLowerCase()] = 2;\n        }\n        if (instanceSettings.jsonData.severity_info != undefined) {\n            this.severityLevels[instanceSettings.jsonData.severity_info.toLowerCase()] = 1;\n        }\n    }\n\n    createUrl({queryActive, querySilenced, queryInhibited, expr = []}) {\n        const active = queryActive ? 'true' : 'false';\n        const silenced = querySilenced ? 'true' : 'false';\n        const inhibited = queryInhibited ? 'true' : 'false';\n        let url = `${this.url}/api/v2/alerts?active=${active}&silenced=${silenced}&inhibited=${inhibited}`;\n\n        if (expr !== undefined && expr.length > 0) {\n            url += expr.map(x => `&filter=${x}`).join('');\n        }\n\n        return url;\n    }\n\n    metricFindQuery(query) {\n        let matchedFunction = {};\n        if (query) {\n            const queryTypes = [\n                {\n                    type: 'names',\n                    regex: /^(label|annotation)_names\\((.*?)\\)\\s*$/\n                },\n                {\n                    type: 'values',\n                    regex: /^(label|annotation)_values\\((?:(.+),\\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\\)\\s*$/\n                },\n                {\n                    type: 'key',\n                    regex: /^(labels|annotations|receivers|generatorURL)\\((.*?)\\)\\s*$/\n                }\n            ];\n            for (let i = 0; i < queryTypes.length; i++) {\n                queryTypes[i].matches = query.match(queryTypes[i].regex);\n                if (queryTypes[i].matches) {\n                    matchedFunction = queryTypes[i];\n                    break;\n                }\n            }\n            if (matchedFunction.type) {\n                query = matchedFunction[2] || ''\n            }\n            if (query) {\n                query = encodeURIComponent(this.templateSrv.replace(query, {}, this.interpolateQueryExpr) || \"\");\n            }\n        }\n        let unique = new Set();\n        let results = [];\n        const defaultTargetData = {\n            queryActive: true,\n            querySilenced: false,\n            queryInhibited: false,\n            expr: query\n        };\n        return this.backendSrv.datasourceRequest({\n            url: this.createUrl(defaultTargetData),\n            method: 'GET',\n            headers: { 'Content-Type': 'application/json' },\n            withCredentials: this.withCredentials\n        }).then(response => {\n            response.data.forEach(value => {\n                if (matchedFunction.type === 'key') {\n                    value = value[matchedFunction.matches[1]];\n                } else if (matchedFunction.type === 'names') {\n                    value = Object.keys(value[matchedFunction.matches[1] + 's'])\n                } else if (matchedFunction.type === 'values') {\n                    value = value[matchedFunction.matches[1] + 's'][matchedFunction.matches[3]];\n                }\n                _.castArray(value).forEach(v => {\n                    if (v) {\n                        if (typeof v === 'object') {\n                            v = JSON.stringify(v);\n                        }\n                        if (!unique.has(v)) {\n                            unique.add(v);\n                            results.push({text: v})\n                        }\n                    }\n                })\n            });\n            return results;\n        });\n    }\n\n    query(options) {\n        let query = this.buildQueryParameters(options);\n        query.targets = query.targets.filter(t => !t.hide);\n        if (query.targets.length <= 0) {\n            return this.q.when({data: []});\n        }\n        let url = this.createUrl(query.targets[0]);\n        // Format data for table panel\n        if (query.targets[0].type === \"table\") {\n            let labelSelector = this.parseLabelSelector(query.targets[0].labelSelector);\n            return this.backendSrv.datasourceRequest({\n                url: url,\n                method: 'GET',\n                headers: { 'Content-Type': 'application/json' },\n                withCredentials: this.withCredentials\n            }).then(response => {\n                let results = {\n                    \"data\": [{\n                        \"rows\": [],\n                        \"columns\": [],\n                        \"type\": \"table\"\n                    }]\n                };\n\n                if (response.data && response.data && response.data.length) {\n                    let columnsDict = this.getColumnsDict(response.data, labelSelector);\n                    results.data[0].columns = this.getColumns(columnsDict);\n\n                    for (let i = 0; i < response.data.length; i++) {\n                        let row = new Array(results.data[0].columns.length).fill(\"\");\n                        let item = response.data[i];\n                        row[0] = [Date.parse(item['startsAt'])];\n\n                        for (let label of Object.keys(item['labels'])) {\n                            if (label in columnsDict) {\n                                if (label === 'severity') {\n                                    row[columnsDict[label]] = this.severityLevels[item['labels'][label]]\n                                } else {\n                                    row[columnsDict[label]] = item['labels'][label];\n                                }\n                            }\n                        }\n                        for (let annotation of Object.keys(item['annotations'])) {\n                            if (annotation in columnsDict) {\n                                row[columnsDict[annotation]] = item['annotations'][annotation];\n                            }\n                        }\n                        results.data[0].rows.push(row);\n                    }\n                }\n                return results;\n            });\n        } else {\n            return this.backendSrv.datasourceRequest({\n                url: url,\n                method: 'GET',\n                headers: { 'Content-Type': 'application/json' },\n                withCredentials: this.withCredentials\n            }).then(response => {\n                return {\n                    \"data\": [{\"datapoints\": [[response.data.length, Date.now()]]}]\n                }\n            });\n        }\n    }\n\n    interpolateQueryExpr(value, variable, defaultFormatFn) {\n        if (typeof value === 'string') {\n            return dsSpecialRegexEscape(value);\n        }\n\n        let escapedValues = _.map(value, dsSpecialRegexEscape);\n        return escapedValues.join('|');\n    }\n\n    getColumns(columnsDict) {\n        let columns = [{text: \"Time\", type: \"time\"}];\n        for (let column of Object.keys(columnsDict)) {\n            columns.push({text: column, type: \"string\"})\n        }\n        return columns;\n    }\n\n    // Parses the label list into a map\n    parseLabelSelector(input) {\n        let map;\n        if (typeof (input) === \"undefined\" || input.trim().length === 0) {\n            map = [\"*\"];\n        } else {\n            map = input.trim().split(/\\s*,\\s*/);\n        }\n        return map;\n    }\n\n    // Creates a column index dictionary in to assist in data row construction\n    getColumnsDict(data, labelSelector) {\n        let index = 1; // 0 is the data column\n        let columnsDict = {};\n        let severityDefined = false;\n        for (let i = 0; i < data.length; i++) {\n            for (let labelIndex = 0; labelIndex < labelSelector.length; labelIndex++) {\n                let selectedLabel = labelSelector[labelIndex];\n                if (selectedLabel === \"*\") {\n                    // '*' maps to all labels/annotations not already added via the label selector list\n                    for (let label of Object.keys(data[i]['labels'])) {\n                        if (!(label in columnsDict)) {\n                            if (label === 'severity') {\n                                severityDefined = true\n                            }\n                            columnsDict[label] = index++;\n                        }\n                    }\n                    for (let annotation of Object.keys(data[i]['annotations'])) {\n                        if (!(annotation in columnsDict)) {\n                            columnsDict[annotation] = index++;\n                        }\n                    }\n                } else if (!(selectedLabel in columnsDict)) {\n                    if (selectedLabel === 'severity') {\n                        severityDefined = true\n                    }\n                    columnsDict[selectedLabel] = index++;\n                }\n            }\n        }\n        if (!severityDefined) {\n            columnsDict['severity'] = index++;\n        }\n        return columnsDict;\n    }\n\n    testDatasource() {\n        return this.backendSrv.datasourceRequest({\n            url: this.url + '/api/v2/status',\n            method: 'GET',\n            withCredentials: this.withCredentials\n        }).then(response => {\n            if (response.status === 200) {\n                return {status: \"success\", message: \"Data source is working\", title: \"Success\"};\n            }\n        });\n    }\n\n    buildQueryParameters(options) {\n        //remove placeholder targets\n        options.targets = _.filter(options.targets, target => {\n            return target.target !== 'select metric';\n        });\n\n        options.targets = _.map(options.targets, ({target, expr, type = 'single', legendFormat = '', ...props}) => {\n            let exprArray = expr.split(/[;,.\\n ]/).filter(x => x.length > 0).map(x => this.templateSrv.replace(x, {}, 'pipe'));\n\n            return {\n                ...props,\n                type,\n                legendFormat,\n                target: this.templateSrv.replace(target),\n                expr: exprArray\n            };\n        });\n        return options;\n    }\n\n    formatInstanceText(labels, legendFormat) {\n        if (legendFormat === \"\") {\n            return JSON.stringify(labels);\n        }\n        let aliasRegex = /\\{\\{\\s*(.+?)\\s*\\}\\}/g;\n        return legendFormat.replace(aliasRegex, function (match, g1) {\n            if (labels[g1]) {\n                return labels[g1];\n            }\n            return \"\";\n        });\n    }\n\n}\n\nexport function dsRegularEscape(value) {\n    if (typeof value === 'string') {\n        return value.replace(/'/g, \"\\\\\\\\'\");\n    }\n    return value;\n}\n\nexport function dsSpecialRegexEscape(value) {\n    if (typeof value === 'string') {\n        return dsRegularEscape(value.replace(/\\\\/g, '\\\\\\\\\\\\\\\\').replace(/[$^*{}\\[\\]+?.()]/g, '\\\\\\\\$&'));\n    }\n    return value;\n}\n"]}